<div class="instructor-schedule" dir="rtl">
  <div class="schedule-wrap" [class.fullscreen]="isFullscreen">

    <!-- ▬▬▬ לוח שנה ▬▬▬ -->
    <div class="bereshit-calendar calendar-host">
      <app-schedule
        [items]="items"
        [initialView]="currentView"
        (eventClick)="onEventClick($event)"
        (dateClick)="onDateClick($event)"
        (viewRange)="onViewRangeChange($event)"
        (rightClickDay)="onRightClickDay($event)">
      </app-schedule>
    </div>

  </div>

  <!-- ▬▬▬ תפריט קליק ימני ▬▬▬ -->
  <div
    class="context-menu"
    *ngIf="contextMenu.visible"
    [style.top.px]="contextMenu.y"
    [style.left.px]="contextMenu.x">
    <button (click)="openRequest('holiday')">🏖️ יום חופש</button>
    <button (click)="openRequest('sick')">🤒 יום מחלה</button>
    <button (click)="openRequest('personal')">📌 יום אישי</button>
    <button (click)="openRequest('other')">📝 אחר</button>
  </div>
</div>

<!-- 🔴 כאן! כרטסת הילד -->
<app-note
  *ngIf="selectedChild && selectedOccurrence"
  [child]="selectedChild"
  [occurrence]="selectedOccurrence"
  [attendanceStatus]="attendanceStatus"
  [role]="currentUserRole"
  (attendanceChange)="attendanceStatus = $event"
  (close)="onCloseNote()">
</app-note>

<!-- ▬▬▬ מודאל בקשת חופש ▬▬▬ -->
<div class="modal-backdrop" *ngIf="rangeModal.open">
  <div class="modal">

    <h3>בקשת היעדרות</h3>

    <div class="date-row">
      <div class="field-row">
        <label>מתאריך</label>
        <input type="date" [(ngModel)]="rangeModal.from" />
      </div>

      <div class="field-row">
        <label>עד תאריך</label>
        <input type="date" [(ngModel)]="rangeModal.to" />
      </div>
    </div>

    <div class="all-day-row">
      <input type="checkbox" [(ngModel)]="rangeModal.allDay" />
      <label>יום מלא</label>
    </div>

    <div *ngIf="!rangeModal.allDay" class="date-row">
      <div class="field-row">
        <label>משעה</label>
        <input type="time" [(ngModel)]="rangeModal.fromTime" />
      </div>

      <div class="field-row">
        <label>עד שעה</label>
        <input type="time" [(ngModel)]="rangeModal.toTime" />
      </div>
    </div>

    <div class="field-row">
      <label>סיבת הבקשה</label>
      <textarea [(ngModel)]="rangeModal.text"></textarea>
    </div>

    <div class="modal-actions">
      <button class="cancel" (click)="closeRangeModal()">ביטול</button>
      <button class="confirm" (click)="submitRange()">שמור</button>
    </div>

  </div>
</div>

<!-- ✅ פופאפ הורים מושפעים (חייב להיות OUTSIDE ל-rangeModal.open) -->
<div class="modal-backdrop" *ngIf="showAffectedParentsPopup">
  <div class="modal">
    <h3>שימו לב</h3>

    <p>בקשת החופש תשפיע על ההורים הבאים:</p>

    <ul>
      <li *ngFor="let p of affectedParents">
        {{ p.first_name }} {{ p.last_name }} – {{ p.phone }}
      </li>
    </ul>

    <div class="modal-actions">
      <button class="cancel" (click)="cancelAffectedPopup()">
        ביטול
      </button>
      <button class="confirm" (click)="confirmSaveAfterWarning()">
        המשך
      </button>
    </div>
  </div>
</div>
