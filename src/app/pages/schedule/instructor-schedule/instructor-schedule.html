<div class="instructor-schedule" dir="rtl">
  <div class="schedule-wrap" [class.fullscreen]="isFullscreen">

    <!-- ▬▬▬ Toolbar ▬▬▬ -->
    <div class="card calendar-toolbar">

      <div class="view-buttons btn-group">
        <button
          (click)="onToolbarChangeView('timeGridDay')"
          [class.active]="currentView === 'timeGridDay'">
          יומי
        </button>

        <button
          (click)="onToolbarChangeView('timeGridWeek')"
          [class.active]="currentView === 'timeGridWeek'">
          שבועי
        </button>

        <button
          (click)="onToolbarChangeView('dayGridMonth')"
          [class.active]="currentView === 'dayGridMonth'">
          חודשי
        </button>
      </div>

      <div class="current-date">
        {{ currentDate }}
      </div>

      <div class="actions btn-group">
        <button (click)="onToolbarPrev()">קודם</button>
        <button (click)="onToolbarToday()">היום</button>
        <button (click)="onToolbarNext()">הבא</button>

        <button class="fullscreen-btn" (click)="toggleMainFullscreen()">
          {{ isFullscreen ? 'צמצם' : 'מסך מלא' }}
        </button>
      </div>

    </div>

    <!-- ▬▬▬ לוח שנה ▬▬▬ -->
    <div class="bereshit-calendar calendar-host">
      <app-schedule
        [items]="items"
        [initialView]="currentView"
        (eventClick)="onEventClick($event)"
        (dateClick)="onDateClick($event)"
        (viewRange)="onViewRangeChange($event)"
        (rightClickDay)="onRightClickDay($event)">
      </app-schedule>
    </div>

  </div>

  <!-- ▬▬▬ הערות על ילד ▬▬▬ -->
 <app-note
  *ngIf="selectedChild"
  [child]="selectedChild"
  [occurrence]="selectedOccurrence"
  [attendanceStatus]="attendanceStatus"
  [role]="currentUserRole"
  [enforceNoteForPresence]="true"
  (attendanceChange)="attendanceStatus = $event"
  (close)="onCloseNote()">
</app-note>


  <!-- ▬▬▬ תפריט קליק ימני ▬▬▬ -->
  <div
    class="context-menu"
    *ngIf="contextMenu.visible"
    [style.top.px]="contextMenu.y"
    [style.left.px]="contextMenu.x">
    <button (click)="openRequest('holiday')">בקשת יום חופש</button>
    <button (click)="openRequest('sick')">בקשת יום מחלה</button>
    <button (click)="openRequest('personal')">בקשה אישית</button>
    <button (click)="openRequest('other')">בקשה אחרת…</button>
  </div>

  <!-- ▬▬▬ מודאל טווח ימים/שעות ▬▬▬ -->
  <div class="modal-backdrop" *ngIf="rangeModal.open">
    <div class="modal">
      <h3>בקשת היעדרות</h3>

      <div class="field-row">
        <label>מתאריך</label>
        <input type="date" [(ngModel)]="rangeModal.from" />
      </div>

      <div class="field-row">
        <label>עד תאריך</label>
        <input type="date" [(ngModel)]="rangeModal.to" />
      </div>

      <div class="field-row checkbox-row">
        <label>
          <input type="checkbox" [(ngModel)]="rangeModal.allDay" />
          יום מלא
        </label>
      </div>

      <div class="field-row time-row" *ngIf="!rangeModal.allDay">
        <div>
          <label>משעה</label>
          <input type="time" [(ngModel)]="rangeModal.fromTime" />
        </div>
        <div>
          <label>עד שעה</label>
          <input type="time" [(ngModel)]="rangeModal.toTime" />
        </div>
      </div>

      <div class="field-row">
        <label>סוג בקשה</label>
        <select [(ngModel)]="rangeModal.type">
          <option value="holiday">יום חופש</option>
          <option value="sick">יום מחלה</option>
          <option value="personal">בקשה אישית</option>
          <option value="other">אחר</option>
        </select>
      </div>

      <div class="field-row">
        <label>סיבת הבקשה</label>
        <textarea
          [(ngModel)]="rangeModal.text"
          rows="3"
          placeholder="כתוב/י סיבה לבקשה">
        </textarea>
      </div>

      <div class="modal-actions">
        <button class="confirm" (click)="submitRange()">שמור</button>
        <button class="cancel" (click)="closeRangeModal()">ביטול</button>
      </div>
    </div>
  </div>

  <!-- ▬▬▬ חלון אישור/דחייה ▬▬▬ -->
  <div
    class="approval-menu"
    *ngIf="approvalMenu.open"
    [style.top.px]="approvalMenu.y"
    [style.left.px]="approvalMenu.x">
    <p><b>{{ getRequestLabel(approvalMenu.request?.request_type!) }}</b></p>
    <p>תאריך: {{ approvalMenu.request?.request_date }}</p>

    <p *ngIf="approvalMenu.request?.note">
      הערה: {{ approvalMenu.request?.note }}
    </p>

    <div class="actions">
      <button class="approve" (click)="approveRequest()">אישור</button>
      <button class="reject" (click)="rejectRequest()">דחייה</button>
      <button class="cancel" (click)="closeApprovalMenu()">סגור</button>
    </div>
  </div>

</div>
