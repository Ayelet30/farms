<h2>×¨×©×™××ª ×”×•×¨×™×</h2>

<button class="fab" (click)="openAddParentDialog()" title="×”×•×¡×¤×ª ×”×•×¨×”">ï¼‹</button>

<div *ngIf="isLoading" class="loading-state">
  ×˜×•×¢×Ÿ × ×ª×•× ×™×... â³
</div>

<div *ngIf="error" class="error-state">
  ×©×’×™××”: {{ error }}
</div>

<div *ngIf="!isLoading && !error && parents.length > 0">
  <table>
    <thead>
      <tr>
        <th>×©× ××œ×</th>
        <th>×˜×œ×¤×•×Ÿ</th>
        <th>××™××™×™×œ</th>
      </tr>
    </thead>
    <tbody>
      <!-- ×‘×œ×—×™×¦×” × ×¤×ª×— ××ª ××’×™×¨×ª ×”×¤×¨×˜×™× -->
      <tr *ngFor="let parent of parents"
          (click)="openDetails(parent.uid)"
          class="clickable-row">
        <td>{{ parent.full_name }}</td>
        <td>{{ parent.phone }}</td>
        <td>{{ parent.email }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="!isLoading && !error && (parents?.length ?? 0) === 0" class="empty-state">
  ×œ× × ××¦××• ×”×•×¨×™× ×‘×—×•×•×ª ×”× ×ª×•× ×™×.
</div>

<!-- ××’×™×¨×” ×¢× ×¤×¨×˜×™ ×”×”×•×¨×” ×”× ×‘×—×¨ -->
<mat-sidenav-container
  class="drawer-container"
  dir="rtl"
  [hasBackdrop]="false"
  [class.drawer-open]="!!selectedUid">

  <mat-sidenav
    #drawer
    mode="side"
    position="end"
    class="drawer-pane"
    [opened]="!!selectedUid">

    <div class="drawer-header">
      <button class="close-btn" (click)="closeDetails()">âœ•</button>
      <h3>×¤×¨×˜×™ ×”×•×¨×”</h3>
    </div>

    <div *ngIf="drawerLoading" class="hint">×˜×•×¢×Ÿ ×¤×¨×˜×™×...</div>

    <ng-container *ngIf="!drawerLoading && drawerParent">

      <!-- ×¤×¨×˜×™× ××™×©×™×™× -->
      <section class="grid2">
        <div>
          <label>×©× ××œ×</label>
          <div class="val">{{ drawerParent.full_name || 'â€”' }}</div>
        </div>
        <div>
          <label>×ª×¢×•×“×ª ×–×”×•×ª</label>
          <div class="val">{{ drawerParent.id_number || 'â€”' }}</div>
        </div>
        <div>
          <label>×˜×œ×¤×•×Ÿ</label>
          <div class="val">{{ drawerParent.phone || 'â€”' }}</div>
        </div>
        <div>
          <label>××™××™×™×œ</label>
          <div class="val">{{ drawerParent.email || 'â€”' }}</div>
        </div>
        <div class="colspan">
          <label>×›×ª×•×‘×ª</label>
          <div class="val">{{ drawerParent.address || 'â€”' }}</div>
        </div>
        <div class="colspan">
          <label>×”×¢×¨×•×ª</label>
          <div class="val prewrap">{{ drawerParent.extra_notes || 'â€”' }}</div>
        </div>
      </section>

      <hr>

      <!-- ×”×¢×“×¤×•×ª ×ª×§×©×•×¨×ª -->
      <section class="prefs">
        <h4>×”×¢×“×¤×•×ª ×ª×§×©×•×¨×ª</h4>
        <div class="chips">
          <span class="chip" *ngIf="drawerParent?.message_preferences?.includes('inapp')">××¤×œ×™×§×¦×™×”</span>
          <span class="chip" *ngIf="drawerParent?.message_preferences?.includes('email')">××™××™×™×œ</span>
          <span class="chip" *ngIf="drawerParent?.message_preferences?.includes('sms')">SMS</span>
          <span class="chip" *ngIf="drawerParent?.message_preferences?.includes('whatsapp')">×•×•××˜×¡××¤</span>
          <span class="chip muted" *ngIf="!(drawerParent?.message_preferences?.length)">
            ×‘×¨×™×¨×ª ××—×“×œ: ××¤×œ×™×§×¦×™×”
          </span>
        </div>
      </section>

      <!-- ğŸ§’ ×¨×©×™××ª ×™×œ×“×™× -->
      <hr>
      <section class="children-list" *ngIf="drawerChildren.length > 0">
        <h4>×™×œ×“×™×</h4>
        <ul>
          <li *ngFor="let child of drawerChildren">
            ğŸ‘¶ {{ child.full_name }}
            <span class="muted">
              ({{ child.gender || '×œ× ×¦×•×™×™×Ÿ' }}, {{ child.status || 'â€”' }})
            </span>
          </li>
        </ul>
      </section>

      <section *ngIf="!drawerLoading && drawerChildren.length === 0">
        <div class="hint">××™×Ÿ ×™×œ×“×™× ××©×•×™×›×™× ×œ×”×•×¨×” ×–×”.</div>
      </section>

    </ng-container>
  </mat-sidenav>
  <div></div>
</mat-sidenav-container>
