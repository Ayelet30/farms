<h2>×¨×©×™××ª ×”×•×¨×™×</h2>

<!-- ×¢×˜×™×¤×” ×œ×©×•×¨×ª ×”×—×™×¤×•×© -->
<div class="search-shell">
  <!-- ×©×•×¨×ª ×”×—×™×¤×•×© ×¢×¦××” -->
  <div class="simple-search-bar" (click)="toggleSearchPanel($event)">
    <!-- ××™×™×§×•×Ÿ ×–×›×•×›×™×ª ××’×“×œ×ª (×™××™×Ÿ) -->
 <span
  class="material-symbols-rounded search-icon"
  title="×—×™×¤×•×©"
  (click)="toggleSearchPanel(); $event.stopPropagation()"
>
  search
</span>


    <!-- ×©×“×” ×”×—×™×¤×•×© â€“ ×¨×§ placeholder ×‘×××¦×¢ -->
    <input
      type="text"
      class="simple-search-input"
      [(ngModel)]="searchText"
      placeholder="×—×™×¤×•×©"
      (click)="$event.stopPropagation()"
    />

    <!-- ××™×™×§×•×Ÿ ×¤×™×œ×˜×¨ (×©×××œ) -->
<span
  class="material-symbols-rounded filter-icon"
  title="×¡×™× ×•×Ÿ"
  (click)="toggleSearchPanel(); $event.stopPropagation()"
>
  filter_alt
</span>


  </div>

  <!-- ×ª×¤×¨×™×˜ ×§×˜×Ÿ ×©× ×¤×ª×— ××ª×—×ª ×œ×©×•×¨×ª ×”×—×™×¤×•×© -->
  <div
    *ngIf="showSearchPanel"
    class="search-panel"
    (click)="$event.stopPropagation()"
  >
    <div class="panel-title">××™×š ×œ×—×¤×©?</div>

    <label class="panel-option">
      <input
        type="radio"
        name="searchMode"
        value="name"
        [(ngModel)]="searchMode"
      />
      ×œ×¤×™ ×©× ×¤×¨×˜×™ / ××©×¤×—×”
    </label>

    <label class="panel-option">
      <input
        type="radio"
        name="searchMode"
        value="id"
        [(ngModel)]="searchMode"
      />
      ×œ×¤×™ ×ª×¢×•×“×ª ×–×”×•×ª (×ª×´×–)
    </label>

    <hr />

    <div class="panel-title">×¡×™× ×•×Ÿ</div>

    <label class="panel-label">×¡×˜×˜×•×¡ ×”×•×¨×”</label>
    <select [(ngModel)]="statusFilter">
      <option value="all">×›×œ ×”×”×•×¨×™×</option>
      <option value="active">×¤×¢×™×œ</option>
      <option value="inactive">×œ× ×¤×¢×™×œ</option>
    </select>

    <label class="panel-label">×™×œ×“×™×</label>
    <select [(ngModel)]="childrenFilter">
      <option value="all">×œ×œ× ×¡×™× ×•×Ÿ</option>
      <option value="active">×¢× ×™×œ×“×™× ×¤×¢×™×œ×™×</option>
      <option value="inactive">×¢× ×™×œ×“×™× ×œ× ×¤×¢×™×œ×™×</option>
    </select>

    <button type="button" class="panel-clear" (click)="clearFilters()">
      ××™×¤×•×¡ ×—×™×¤×•×© ×•×¡×™× ×•×Ÿ
    </button>
  </div>
</div>




<button class="fab" (click)="openAddParentDialog()" title="×”×•×¡×¤×ª ×”×•×¨×”">ï¼‹</button>


<div *ngIf="isLoading" class="loading-state">
  ×˜×•×¢×Ÿ × ×ª×•× ×™×... â³
</div>

<div *ngIf="error" class="error-state">
  ×©×’×™××”: {{ error }}
</div>

<div *ngIf="!isLoading && !error && parents.length > 0">
  <table>
    <thead>
      <tr>
        <th>×©× ×¤×¨×˜×™</th>
        <th>×©× ××©×¤×—×”</th>
        <th>×˜×œ×¤×•×Ÿ</th>
        <th>××™××™×™×œ</th>
      </tr>
    </thead>
    <tbody>
      <!-- ×‘×œ×—×™×¦×” × ×¤×ª×— ××ª ××’×™×¨×ª ×”×¤×¨×˜×™× -->
       <tr *ngFor="let parent of filteredParents"
       (click)="openDetails(parent.uid!)"
        class="clickable-row">
        <td>{{ parent.first_name }}</td>
        <td>{{ parent.last_name }}</td>
        <td>{{ parent.phone }}</td>
        <td>{{ parent.email }}</td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="!isLoading && !error && (parents?.length ?? 0) === 0" class="empty-state">
  ×œ× × ××¦××• ×”×•×¨×™× ×‘×—×•×•×ª ×”× ×ª×•× ×™×.
</div>

<!-- ××’×™×¨×” ×¢× ×¤×¨×˜×™ ×”×”×•×¨×” ×”× ×‘×—×¨ -->
<mat-sidenav-container
  class="drawer-container"
  dir="rtl"
  [hasBackdrop]="false"
  [class.drawer-open]="!!selectedUid">

  <mat-sidenav
    #drawer
    mode="side"
    position="end"
    class="drawer-pane"
    [opened]="!!selectedUid">

    <div class="drawer-header">
      <button class="close-btn" (click)="closeDetails()">âœ•</button>
      <h3>×¤×¨×˜×™ ×”×•×¨×”</h3>
    </div>

    <div *ngIf="drawerLoading" class="hint">×˜×•×¢×Ÿ ×¤×¨×˜×™×...</div>

    <ng-container *ngIf="!drawerLoading && drawerParent as parent">

  <!-- ×¤×¨×˜×™× ××™×©×™×™× -->
  <section class="grid2">
    <div>
      <label>×©× ×¤×¨×˜×™ ×•×©× ××©×¤×—×”</label>
      <div class="val">
        {{
          (parent.first_name || parent.last_name)
            ? (parent.first_name || '') + ' ' + (parent.last_name || '')
            : 'â€”'
        }}
      </div>
    </div>

    <div>
      <label>×ª×¢×•×“×ª ×–×”×•×ª</label>
      <div class="val">{{ parent.id_number || 'â€”' }}</div>
    </div>

    <div>
      <label>×˜×œ×¤×•×Ÿ</label>
      <div class="val">{{ parent.phone || 'â€”' }}</div>
    </div>

    <div>
      <label>××™××™×™×œ</label>
      <div class="val">{{ parent.email || 'â€”' }}</div>
    </div>

    <div class="colspan">
      <label>×›×ª×•×‘×ª</label>
      <div class="val">{{ parent.address || 'â€”' }}</div>
    </div>

    <div class="colspan">
      <label>×”×¢×¨×•×ª</label>
      <div class="val prewrap">{{ parent.extra_notes || 'â€”' }}</div>
    </div>
  </section>

  <hr />

  <!-- ×”×¢×“×¤×•×ª ×ª×§×©×•×¨×ª -->
  <section class="prefs">
    <h4>×”×¢×“×¤×•×ª ×ª×§×©×•×¨×ª</h4>
    <div class="chips">
      <span class="chip" *ngIf="parent.message_preferences?.includes('inapp')">
        ××¤×œ×™×§×¦×™×”
      </span>
      <span class="chip" *ngIf="parent.message_preferences?.includes('email')">
        ××™××™×™×œ
      </span>
      <span class="chip" *ngIf="parent.message_preferences?.includes('sms')">
        SMS
      </span>
      <span class="chip" *ngIf="parent.message_preferences?.includes('whatsapp')">
        ×•×•××˜×¡××¤
      </span>
      <span class="chip muted" *ngIf="!(parent.message_preferences?.length)">
        ×‘×¨×™×¨×ª ××—×“×œ: ××¤×œ×™×§×¦×™×”
      </span>
    </div>
  </section>

  <hr />

  <!-- ğŸ§’ ×¨×©×™××ª ×™×œ×“×™× -->
  <section class="children-list" *ngIf="drawerChildren.length > 0">
    <h4>×™×œ×“×™×</h4>
    <ul>
      <li *ngFor="let child of drawerChildren">
        ğŸ‘¶ {{ child.first_name }} {{ child.last_name }}
        <span class="muted">
          ({{ child.gender || '×œ× ×¦×•×™×™×Ÿ' }}, {{ child.status || 'â€”' }})
        </span>
      </li>
    </ul>
  </section>

  <section *ngIf="!drawerLoading && drawerChildren.length === 0">
    <div class="hint">××™×Ÿ ×™×œ×“×™× ××©×•×™×›×™× ×œ×”×•×¨×” ×–×”.</div>
  </section>

</ng-container>

  </mat-sidenav>
  <div></div>
</mat-sidenav-container>
