<div class="children-container">
  <div *ngIf="loading">×˜×•×¢×Ÿ...</div>
  <div *ngIf="!loading && children.length === 0">××™×Ÿ ×™×œ×“×™× ×œ×”×¦×’×”.</div>

  <!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×™×œ×“ -->
  <div class="children-buttons" *ngIf="children.length > 0">
    <button
      *ngFor="let child of children"
      (click)="toggleChildDetails(child)"
      [class.active]="selectedChild?.child_uuid === child.child_uuid" 
      class="child-button"
    >
      {{ child.full_name }}
    </button>

    <button (click)="addNewChild()" class="child-button add-button" type="button">â•</button> <!-- CHANGED -->
  </div>

  <!-- ×›×¨×˜×™×¡ ×™×œ×“ × ×‘×—×¨ -->
  <div class="child-card" *ngIf="selectedChild">
    <div class="child-header">
      <div *ngIf="!isEditing">
        <h3>{{ selectedChild.full_name }}</h3>
      </div>
      <div *ngIf="isEditing">
        <input [(ngModel)]="editableChild.full_name" class="editable-title" />
      </div>

      <div class="button-group">
        <button *ngIf="!isEditing" (click)="isEditing = true" class="btn-edit" type="button">âœï¸ ×¢×¨×•×š</button>
        <button *ngIf="isEditing" (click)="saveChild()" class="btn-save" type="button">ğŸ’¾ ×©××•×¨</button> <!-- CHANGED -->
        <button class="btn-delete" (click)="confirmDeleteChild()" type="button">ğŸ—‘ï¸ ×”×¡×¨</button> <!-- CHANGED -->
      </div>
    </div>

    <!-- ×”×¦×’×ª ×ª"×– ×××™×ª×™×ª ××”×©×“×” gov_id ×‘××§×•× id -->
    <p><strong>×ª"×–:</strong> {{ selectedChild.gov_id || '-' }}</p> <!-- CHANGED -->

    <p>
      <strong>×’×™×œ:</strong>
      <span *ngIf="!isEditing">{{ getAge(selectedChild.birth_date) }} ×©× ×™×</span>
      <input *ngIf="isEditing" type="number" [(ngModel)]="editableChild.age" class="editable-input" />
    </p>

    <p>
      <strong>××™×Ÿ:</strong>
      <span *ngIf="!isEditing">{{ selectedChild.gender || '-' }}</span>
      <select *ngIf="isEditing" [(ngModel)]="editableChild.gender" class="editable-input" required>
        <option value="" disabled hidden>×‘×—×¨ ××™×Ÿ</option>
        <option value="×–×›×¨">×–×›×¨</option>
        <option value="× ×§×‘×”">× ×§×‘×”</option>
      </select>
    </p>

    <p>
      <strong>×§×•×¤×ª ×—×•×œ×™×:</strong>
      <span *ngIf="!isEditing">{{ selectedChild.health_fund || '-' }}</span>
      <select *ngIf="isEditing" [(ngModel)]="editableChild.health_fund" class="editable-input" required>
        <option value="" disabled hidden>×‘×—×¨ ×§×•×¤×”</option>
        <option *ngFor="let fund of healthFunds" [value]="fund">{{ fund }}</option>
      </select>
    </p>

    <!-- ××“×¨×™×š (×œ× ×—×•×‘×” ×›×¨×’×¢)
    <p>
      <strong>××“×¨×™×š:</strong>
      <span *ngIf="!isEditing">{{ selectedChild.instructor || '-' }}</span>
      <select *ngIf="isEditing" [(ngModel)]="editableChild.instructor" class="editable-input">
        <option value="" disabled hidden>×‘×—×¨ ××“×¨×™×š</option>
        <option *ngFor="let name of instructors" [value]="name">{{ name }}</option>
      </select>
    </p>
    -->

    <p>
      <strong>×¡×˜×˜×•×¡:</strong>
      <span
        [ngClass]="{
          'status-active': selectedChild.status === 'active',
          'status-waiting': selectedChild.status === 'waiting',
          'status-inactive': selectedChild.status !== 'active' && selectedChild.status !== 'waiting'
        }"
      >
        {{
          selectedChild.status === 'active'
            ? '×¤×¢×™×œ'
            : selectedChild.status === 'waiting'
            ? '×××ª×™×Ÿ ×œ××™×©×•×¨ ××–×›×™×¨×”'
            : '×œ× ×¤×¢×™×œ'
        }}
      </span>
    </p>
  </div>
</div>

<!-- ×˜×•×¤×¡ ×”×•×¡×¤×ª ×™×œ×“ ×—×“×© -->
<div class="child-card" *ngIf="newChild">
  <h3>×”×•×¡×¤×ª ×™×œ×“ ×—×“×©</h3>

  <div class="form-field">
    <label>×©× ××œ×</label>
    <input class="editable-input" [(ngModel)]="newChild.full_name" required />
    <div *ngIf="validationErrors['full_name']" class="error-msg">
      {{ validationErrors['full_name'] }}
    </div>
  </div>

  <div class="form-field">
    <label>×ª×¢×•×“×ª ×–×”×•×ª</label>
    <input
      class="editable-input"
      [(ngModel)]="newChild.gov_id" 
      maxlength="9"
      pattern="[0-9]*"
      inputmode="numeric"
      required
      (keypress)="allowOnlyNumbers($event)"
    />
    <div *ngIf="validationErrors['gov_id']" class="error-msg"> <!-- CHANGED -->
      {{ validationErrors['gov_id'] }}
    </div>
  </div>

  <div class="form-field">
    <label>×ª××¨×™×š ×œ×™×“×”</label>
    <input class="editable-input" type="date" [(ngModel)]="newChild.birth_date" required />
    <div *ngIf="validationErrors['birth_date']" class="error-msg">
      {{ validationErrors['birth_date'] }}
    </div>
  </div>

  <div class="form-field">
    <label>××™×Ÿ</label>
    <select class="editable-input" [(ngModel)]="newChild.gender" required>
      <option value="" disabled hidden>×‘×—×¨ ××™×Ÿ</option>
      <option value="×–×›×¨">×–×›×¨</option>
      <option value="× ×§×‘×”">× ×§×‘×”</option>
    </select>
    <div *ngIf="validationErrors['gender']" class="error-msg">
      {{ validationErrors['gender'] }}
    </div>
  </div>

  <div class="form-field">
    <label>×§×•×¤×ª ×—×•×œ×™×</label>
    <select class="editable-input" [(ngModel)]="newChild.health_fund" required>
      <option value="" disabled hidden>×‘×—×¨ ×§×•×¤×”</option>
      <option *ngFor="let fund of healthFunds" [value]="fund">{{ fund }}</option>
    </select>
    <div *ngIf="validationErrors['health_fund']" class="error-msg">
      {{ validationErrors['health_fund'] }}
    </div>
  </div>

  <div class="button-group">
    <button class="btn-save" (click)="saveNewChild()" type="button">×©××•×¨</button> <!-- CHANGED -->
    <button class="btn-edit" (click)="cancelNewChild()" type="button">×‘×™×˜×•×œ</button> <!-- CHANGED -->
  </div>
</div>

<!-- ×“×™××œ×•×’ ××—×™×§×” -->
<div class="dialog-overlay" *ngIf="showDeleteConfirm">
  <div class="dialog-box">
    <h3>×”×× ××ª ×‘×˜×•×—×” ×©×‘×¨×¦×•× ×š ×œ×”×¡×™×¨ ××ª ×”×™×œ×“?</h3>
    <div class="dialog-buttons">
      <button class="btn-delete" (click)="deleteChild()" type="button">××™×©×•×¨</button> <!-- CHANGED -->
      <button class="btn-edit" (click)="cancelDelete()" type="button">×‘×™×˜×•×œ</button> <!-- CHANGED -->
    </div>
  </div>
</div>
