<div class="req" *ngIf="req() as r">
  <div class="req-head">
    <div class="req-title">יום חופש מדריך</div>

    <div class="meta">
      <div><b>מדריך:</b> {{ r.instructorName || '—' }}</div>
      <div><b>טווח:</b> {{ r.fromDate | date:'dd/MM/yyyy' }} – {{ (r.toDate || r.fromDate) | date:'dd/MM/yyyy' }}</div>
      <div><b>מבקש/ת:</b> {{ r.requestedByName || '—' }}</div>
    </div>
  </div>

  <div class="note-box">
    <label>הערה להחלטה (אופציונלי)</label>
    <textarea
      [ngModel]="decisionNote()"
      (ngModelChange)="decisionNote.set($event)"
      rows="2"
      placeholder="למדריך / לתיעוד..."></textarea>
  </div>

  <div class="impact">
    <div class="impact-title">
      שיעורים שיתבטלו באישור ({{ impactCount() }})
      <button class="mini" type="button" (click)="loadImpact()" [disabled]="loadingImpact()">רענון רשימה</button>
    </div>

    <div *ngIf="loadingImpact()">טוען...</div>

    <table *ngIf="!loadingImpact() && impactRows().length">
      <thead>
        <tr>
          <th>תאריך</th>
          <th>שעה</th>
          <th>ילד/ה</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let x of impactRows()">
          <td>{{ x.occur_date | date:'dd/MM/yyyy' }}</td>
          <td>{{ x.start_time }} - {{ x.end_time }}</td>
          <td>{{ x.child_name || '—' }}</td>
        </tr>
      </tbody>
    </table>

    <div class="empty" *ngIf="!loadingImpact() && !impactRows().length">
      לא נמצאו שיעורים שיושפעו בטווח הזה.
    </div>
  </div>

  <div class="actions">
    <button class="btn reject" type="button" (click)="reject()" [disabled]="loading()">דחייה</button>
    <button class="btn approve" type="button" (click)="approve()" [disabled]="loading() || loadingImpact()">אישור</button>
  </div>
</div>
